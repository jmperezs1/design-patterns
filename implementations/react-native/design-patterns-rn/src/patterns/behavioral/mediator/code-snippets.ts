import type { CodeSnippet } from '../../../registry/types';

export const mediatorCodeSnippets: CodeSnippet[] = [
  { title: 'mediator.ts', language: 'ts', code: `export interface Mediator {\n  notify(sender: unknown, event: string, payload?: unknown): void;\n}` },
  { title: 'colleague.ts', language: 'ts', code: `import type { Mediator } from './mediator';\nexport abstract class Colleague {\n  protected m!: Mediator;\n  setMediator(m: Mediator) { this.m = m; }\n}` },
  { title: 'concrete-mediator.ts', language: 'ts', code: `import type { SearchBox } from './concrete-colleague-a';\nimport type { ResultsList } from './concrete-colleague-b';\nimport type { CategoryFilter } from './concrete-colleague-c';\nimport type { ClearButton } from './concrete-colleague-d';\nimport type { Mediator } from './mediator';\nimport type { Item } from './types/type';\n\nexport class ConcreteMediator implements Mediator {\n  private onLog: (line: string) => void;\n  private A: SearchBox; private B: ResultsList; private C: CategoryFilter; private D: ClearButton;\n  private dataset: Item[];\n  constructor(A: SearchBox, B: ResultsList, C: CategoryFilter, D: ClearButton, dataset: Item[], onLog?: (line: string) => void) {\n    this.A = A; this.B = B; this.C = C; this.D = D; this.dataset = dataset; this.onLog = onLog ?? (() => {});\n    A.setMediator(this); B.setMediator(this); C.setMediator(this); D.setMediator(this);\n  }\n  notify(sender: unknown, event: string, payload?: unknown): void {\n    if (sender === this.A) this.reactOnA(event, payload as string);\n    else if (sender === this.B) this.reactOnB(event, payload as number);\n    else if (sender === this.C) this.reactOnC(event, payload as any);\n    else if (sender === this.D) this.reactOnD(event);\n  }\n  private reactOnA(_: string, q: string) { this.onLog(\`A → query="${'${'}q}"\`); this.refreshResults(); }\n  private reactOnB(_: string, n: number) { this.onLog(\`B → rendered ${'${'}n} items\`); }\n  private reactOnC(_: string, cat: 'all' | Item['category']) { this.onLog(\`C → category=${'${'}cat}\`); this.refreshResults(); }\n  private reactOnD(_: string) { this.onLog('D → clear all'); this.A.value = ''; this.C.value = 'all'; this.refreshResults(); }\n  private refreshResults() {\n    const q = this.A.value.trim().toLowerCase(); const cat = this.C.value;\n    const filtered = this.dataset.filter(it => (cat === 'all' || it.category === cat) && (q === '' || it.name.toLowerCase().includes(q)));\n    this.B.operationB(filtered);\n  }\n}` },
];
